(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[144],{991:(e,a,s)=>{"use strict";s.d(a,{k:()=>i});var t=s(5155);s(2115);var r=s(6657),l=s(4269);function i(e){let{className:a,value:s,...i}=e;return(0,t.jsx)(r.bL,{"data-slot":"progress",className:(0,l.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",a),...i,children:(0,t.jsx)(r.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})}},1120:(e,a,s)=>{"use strict";s.d(a,{T:()=>l});var t=s(5155);s(2115);var r=s(4269);function l(e){let{className:a,...s}=e;return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...s})}},1647:(e,a,s)=>{"use strict";s.d(a,{E:()=>n});var t=s(5155);s(2115);var r=s(3101),l=s(4269);let i=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:a,variant:s,...r}=e;return(0,t.jsx)("div",{className:(0,l.cn)(i({variant:s}),a),...r})}},2491:(e,a,s)=>{Promise.resolve().then(s.bind(s,8991))},4846:(e,a,s)=>{"use strict";s.d(a,{d:()=>n});var t=s(5155),r=s(2115),l=s(7599),i=s(4269);let n=r.forwardRef((e,a)=>{let{className:s,thumbClassName:r,...n}=e;return(0,t.jsx)(l.bL,{className:(0,i.cn)("peer inline-flex h-5 w-10 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...n,ref:a,children:(0,t.jsx)(l.zi,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0",r)})})});n.displayName=l.bL.displayName},5142:(e,a,s)=>{"use strict";s.d(a,{p:()=>l});var t=s(5155);s(2115);var r=s(4269);function l(e){let{className:a,type:s,...l}=e;return(0,t.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...l})}},6444:(e,a,s)=>{"use strict";s.d(a,{J:()=>i});var t=s(5155);s(2115);var r=s(489),l=s(4269);function i(e){let{className:a,...s}=e;return(0,t.jsx)(r.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...s})}},8991:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>G});var t=s(5155),r=s(2115),l=s(63),i=s(3998),n=s(6948),o=s(1647),c=s(991),d=s(8332),m=s(3738),h=s(9559),u=s(2056),g=s(8314),x=s(3166),p=s(6191),b=s(8192),v=s(5880),f=s(1360),j=s(5626),N=s(1786),y=s(5870),w=s(534),_=s(5426),C=s(8720),k=s(2890),A=s(4211),E=s(4739),F=s(5239),P=s(4846),z=s(6444),R=s(1120),I=s(5142),B=s(5229),T=s(2196),D=s(2529),S=s(6046),U=s(5704);let $=[{value:"professional",label:"Professional",icon:"\uD83D\uDC54"},{value:"friendly",label:"Friendly",icon:"\uD83D\uDE0A"},{value:"helpful",label:"Helpful",icon:"\uD83E\uDD1D"},{value:"technical",label:"Technical",icon:"\uD83D\uDD27"},{value:"casual",label:"Casual",icon:"\uD83D\uDCAC"}],J=["#6a8fff","#10B981","#8B5CF6","#F59E0B","#EF4444","#06B6D4","#84CC16","#EC4899","#6366F1","#14B8A6","#F97316","#8B5A2B"];function L(e){let{}=e,a=(0,l.useSearchParams)(),c=(0,l.useRouter)(),{userId:m}=(0,l.useParams)(),h=a.get("id"),[g,x]=(0,r.useState)([]),[p,v]=(0,r.useState)(!1),{saving:f,currentUser:j,selectedChatbot:y,isEditMode:w,config:_,setSaving:k,setOrgChatbots:L,setSelectedChatbot:G,setIsEditMode:Z,setShowCreateForm:M,setConfig:W,updateConfig:O}=(0,A.iS)(),H=(0,r.useCallback)(e=>{var a,s,t;let r=[];return(null==(a=e.name)?void 0:a.trim())||r.push("Chatbot name is required"),e.name&&e.name.length>50&&r.push("Name must be under 50 characters"),(null==(s=e.greeting_message)?void 0:s.trim())||r.push("Greeting message is required"),e.greeting_message&&e.greeting_message.length>200&&r.push("Greeting message must be under 200 characters"),(null==(t=e.fallback_message)?void 0:t.trim())||r.push("Fallback message is required"),r},[]),[Y,q]=(0,r.useState)({name:_.name||"",description:_.description||"",greeting_message:_.greeting_message||"",fallback_message:_.fallback_message||"",behavior:_.behavior||"",system_prompt:_.system_prompt||"",color_hex:_.color_hex||"#3B82F6",avatar_url:_.avatar_url||""}),X=(0,r.useCallback)(e=>{W({...e,description:e.description||"",color_hex:e.color_hex||"#6a8fff",tone:e.tone||"helpful",behavior:e.behavior||"Be helpful and informative",system_prompt:e.system_prompt||"",greeting_message:e.greeting_message||"Hello! How can I help you today?",fallback_message:e.fallback_message||"I'm sorry, I don't have information about that. Could you please rephrase your question?",ai_model_config:{model:"gpt-3.5-turbo",temperature:.7,max_tokens:1e3},is_active:"active"===e.status}),v(!1),x([])},[W,v,x]),K=(0,r.useCallback)(async()=>{try{let e=await E.Ex.getChatbots();if(L(e),h){let a=e.find(e=>e.id===h);a?(G(a),X(a),Z(!0),M(!1)):(C.oR.error("Chatbot not found"),c.push("/dashboard/".concat(m,"/customize")))}else e.length>0?(G(e[0]),X(e[0]),Z(!1),M(!0)):(M(!0),Z(!1))}catch(e){console.error("Error loading organization chatbots:",e),C.oR.error("Failed to load chatbots")}},[h,L,G,Z,M,c,m,X]);(0,r.useEffect)(()=>{K()},[K]),r.useEffect(()=>{console.log("\uD83D\uDD04 Updating input values from config:",{configId:_.id,configName:_.name,isEditMode:w,chatbotId:h}),q({name:_.name||"",description:_.description||"",greeting_message:_.greeting_message||"",fallback_message:_.fallback_message||"",behavior:_.behavior||"",system_prompt:_.system_prompt||"",color_hex:_.color_hex||"#3B82F6",avatar_url:_.avatar_url||""})},[_,_.id,w,h]);let V=(0,r.useCallback)(e=>{var a;let s;return a=a=>{O({[e]:a}),v(!0),x(H({..._,[e]:a}))},function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];clearTimeout(s),s=setTimeout(()=>a(...t),300)}},[O,H,_]),Q=r.useMemo(()=>({name:V("name"),description:V("description"),greeting_message:V("greeting_message"),fallback_message:V("fallback_message"),behavior:V("behavior"),system_prompt:V("system_prompt"),color_hex:V("color_hex"),avatar_url:V("avatar_url"),is_active:V("is_active"),tone:V("tone")}),[V]),ee=(0,r.useCallback)((e,a)=>{var s;q(s=>({...s,[e]:a})),null==(s=Q[e])||s.call(Q,a)},[Q]),ea=(0,r.useCallback)((e,a)=>{O({[e]:a}),v(!0),x(H({..._,[e]:a}))},[O,H,_]),es=(0,r.useCallback)(async e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];if(t){if(!["image/png","image/jpeg","image/jpg","image/gif","image/webp"].includes(t.type))return void C.oR.error("Please upload a valid image file (PNG, JPEG, GIF, or WebP)");if(t.size>2097152)return void C.oR.error("Image size must be less than 2MB");try{let{uploadsApi:e}=await Promise.resolve().then(s.bind(s,4739)),a=await e.uploadFile(t,"image");if(a&&a.url){let e=U.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8001",s=a.url.startsWith("http")?a.url:"".concat(e).concat(a.url);ee("avatar_url",s),C.oR.success("Avatar image uploaded successfully!")}else throw Error("Upload failed - no URL returned")}catch(e){console.error("Avatar upload error:",e),C.oR.error("Failed to upload image: ".concat(e instanceof Error?e.message:"Unknown error"))}}},[ee]),et=(0,r.useCallback)(e=>{if(e.includes("storage/v1/object/uploads/")){let a=e.split("storage/v1/object/uploads/");if(a.length>1){let e=a[1],s=U.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8001";return"".concat(s,"/api/uploads/avatar/legacy/").concat(e)}}return e},[]),er=(0,r.useCallback)(()=>{ee("avatar_url",""),C.oR.success("Avatar cleared")},[ee]),el=async()=>{try{var e,a;let s;k(!0);let t=H(_);if(t.length>0){C.oR.error("Please fix validation errors: ".concat(t.join(", "))),x(t);return}let r={id:(null==y?void 0:y.id)||"",name:_.name,description:_.description,color_hex:_.color_hex,tone:_.tone,behavior:_.behavior,greeting_message:_.greeting_message,status:_.is_active?"active":"inactive",user_id:(null==j?void 0:j.id)||"",org_id:null==j||null==(e=j.user_metadata)?void 0:e.org_id,system_prompt:_.system_prompt,fallback_message:_.fallback_message,avatar_url:_.avatar_url,chain_status:(null==y?void 0:y.chain_status)||"pending",trainer_at:(null==y?void 0:y.trainer_at)||new Date().toISOString(),created_at:(null==y?void 0:y.created_at)||new Date().toISOString(),ai_model_config:_.ai_model_config||{model:"gpt-3.5-turbo",temperature:.7,max_tokens:1e3},deployment_config:(null==y?void 0:y.deployment_config)||{url:"",headers:{},method:""},is_active:_.is_active};console.log("\uD83D\uDCBE Attempting to save chatbot:",{isEditMode:w,chatbotId:null==y?void 0:y.id,chatbotData:r,currentUser:j?{id:j.id,org_id:null==(a=j.user_metadata)?void 0:a.org_id}:null}),w&&(null==y?void 0:y.id)?(console.log("\uD83D\uDD04 Updating existing chatbot:",y.id),s=await E.Ex.updateChatbot(y.id,r),C.oR.success("Chatbot updated successfully!")):(console.log("✨ Creating new chatbot"),s=await E.Ex.createChatbot(r),C.oR.success("Chatbot created successfully!"),Z(!0),M(!1),G(s),c.push("/dashboard/".concat(m,"/customize?id=").concat(s.id))),v(!1),x([]),await K()}catch(a){console.error("❌ Error saving chatbot:",a);let e="Failed to save chatbot configuration";a instanceof Error&&(console.error("\uD83D\uDD0D Error details:",{message:a.message,stack:a.stack,name:a.name}),e=a.message.includes("401")||a.message.includes("Authentication")?"Authentication failed. Please log in again.":a.message.includes("403")?"Permission denied. Check your access rights.":a.message.includes("404")?"Backend endpoint not found. Check if server is running on http://localhost:8001":a.message.includes("500")?"Server error. Please try again later.":a.message.includes("Network")||a.message.includes("fetch")||a.message.includes("Failed to fetch")?"Cannot connect to server. Is the backend running on http://localhost:8001?":"Save failed: ".concat(a.message)),C.oR.error(e)}finally{k(!1)}};return(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(b.A,{className:"w-5 h-5"}),"Advanced Chatbot Configuration",p&&(0,t.jsx)(o.E,{variant:"secondary",className:"ml-2",children:"Unsaved Changes"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(P.d,{checked:_.is_active,onCheckedChange:e=>ea("is_active",e)}),(0,t.jsx)(z.J,{className:"text-sm",children:"Active"})]})]})}),(0,t.jsxs)(n.Wu,{children:[g.length>0&&(0,t.jsxs)(d.Fc,{className:"mb-4 border-red-200 bg-red-50",children:[(0,t.jsx)(u.A,{className:"h-4 w-4 text-red-600"}),(0,t.jsxs)(d.TN,{children:[(0,t.jsx)("strong",{children:"Please fix the following errors:"}),(0,t.jsx)("ul",{className:"mt-2 list-disc list-inside",children:g.map((e,a)=>(0,t.jsx)("li",{className:"text-sm text-red-700",children:e},a))})]})]}),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"my-7 grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(z.J,{htmlFor:"name",children:"Chatbot Name"}),(0,t.jsx)(I.p,{id:"name",value:Y.name,onChange:e=>ee("name",e.target.value),placeholder:"Enter chatbot name...",className:"mt-4"})]})}),(0,t.jsxs)("div",{className:"my-7",children:[(0,t.jsx)(z.J,{children:"Chatbot Avatar"}),(0,t.jsxs)("div",{className:"mt-4 space-y-4",children:[Y.avatar_url&&(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"relative w-20 h-20",children:[(0,t.jsx)(F.default,{src:et(Y.avatar_url),alt:"Avatar preview",width:80,height:80,className:"rounded-full object-cover border-2 border-gray-200",unoptimized:!0}),(0,t.jsx)("button",{type:"button",onClick:er,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",title:"Remove avatar",children:(0,t.jsx)(B.A,{className:"w-4 h-4"})})]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:Y.avatar_url.includes("/api/uploads/avatar/")||Y.avatar_url.includes("storage/v1/object/uploads")?"Uploaded image":"External URL"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.J,{htmlFor:"avatar-url",className:"text-sm text-gray-600",children:"Enter Image URL"}),(0,t.jsx)(I.p,{id:"avatar-url",value:Y.avatar_url,onChange:e=>ee("avatar_url",e.target.value),placeholder:"https://example.com/avatar.png",className:"w-full"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex-1 border-t border-gray-200"}),(0,t.jsx)("span",{className:"text-sm text-gray-500",children:"OR"}),(0,t.jsx)("div",{className:"flex-1 border-t border-gray-200"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.J,{htmlFor:"avatar-file",className:"text-sm text-gray-600",children:"Upload Image File"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(I.p,{id:"avatar-file",type:"file",accept:"image/png,image/jpeg,image/jpg,image/gif,image/webp",onChange:es,className:"hidden"}),(0,t.jsxs)(i.$,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=document.getElementById("avatar-file"))?void 0:e.click()},className:"flex items-center gap-2",children:[(0,t.jsx)(N.A,{className:"w-4 h-4"}),"Choose Image"]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"PNG, JPEG, GIF, WebP (max 1.5MB)"})]})]}),!Y.avatar_url&&(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-md",children:[(0,t.jsx)(T.A,{className:"w-5 h-5 text-gray-400"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"No avatar set. Upload an image or enter a URL."})]})]})]}),(0,t.jsxs)("div",{className:"my-7",children:[(0,t.jsx)(z.J,{htmlFor:"description",children:"Description"}),(0,t.jsx)(R.T,{id:"description",value:Y.description,onChange:e=>ee("description",e.target.value),placeholder:"Describe what this chatbot does and its purpose...",className:"mt-4",rows:3})]}),(0,t.jsxs)("div",{className:"my-7",children:[(0,t.jsx)(z.J,{children:"Personality & Tone"}),(0,t.jsx)("div",{className:"mt-4 grid grid-cols-5 gap-3",children:$.map(e=>(0,t.jsx)("div",{className:"p-2 border rounded-lg cursor-pointer transition-all ".concat(_.tone===e.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>ea("tone",e.value),children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-xl",children:e.icon}),(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"font-medium",children:e.label})}),_.tone===e.value&&(0,t.jsx)(D.A,{className:"h-5 w-5 text-green-600 ml-auto"})]})},e.value))})]}),(0,t.jsxs)("div",{className:"my-9",children:[(0,t.jsx)(z.J,{children:"Primary Color"}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("div",{className:"flex gap-2 mb-3 flex-wrap",children:J.map(e=>(0,t.jsx)("button",{className:"w-6 h-6 rounded-full border-2 ".concat(_.color_hex===e?"border-gray-900 scale-110":"border-gray-200 hover:border-gray-400"," transition-all"),style:{backgroundColor:e},onClick:()=>ea("color_hex",e)},e))}),(0,t.jsx)(I.p,{type:"color",value:Y.color_hex,onChange:e=>ee("color_hex",e.target.value),className:"w-20 h-10"})]})]}),(0,t.jsxs)("div",{className:"my-7 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(z.J,{htmlFor:"greeting",children:"Greeting Message"}),(0,t.jsx)(R.T,{id:"greeting",value:Y.greeting_message,onChange:e=>ee("greeting_message",e.target.value),placeholder:"Hello! How can I help you today?",className:"mt-4",rows:2})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(z.J,{htmlFor:"fallback",children:"Fallback Message"}),(0,t.jsx)(R.T,{id:"fallback",value:Y.fallback_message,onChange:e=>ee("fallback_message",e.target.value),placeholder:"I'm sorry, I don't have information about that...",className:"mt-4",rows:2})]})]}),(0,t.jsxs)("div",{className:"my-9",children:[(0,t.jsx)(z.J,{htmlFor:"behavior",children:"Behavior & Personality"}),(0,t.jsx)(R.T,{id:"behavior",value:Y.behavior,onChange:e=>ee("behavior",e.target.value),placeholder:"Describe how the chatbot should behave, its personality, and interaction style...",className:"mt-4",rows:4})]}),(0,t.jsxs)("div",{className:"my-9",children:[(0,t.jsx)(z.J,{htmlFor:"system-prompt",children:"System Prompt (Advanced)"}),(0,t.jsx)(R.T,{id:"system-prompt",value:Y.system_prompt,onChange:e=>ee("system_prompt",e.target.value),placeholder:"You are a helpful assistant that...",className:"mt-1",rows:6}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"Define specific instructions for the AI. This overrides default behavior settings."})]})]})}),(0,t.jsx)("div",{className:"flex justify-between mt-6 pt-6 border-t",children:(0,t.jsx)(i.$,{onClick:el,disabled:f||g.length>0,className:"pointer flex items-center gap-2 min-w-[150px]",children:f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.A,{className:"w-4 h-4"}),w?"Update Chatbot":"Create Chatbot"]})})})]})]})}function G(){let e=(0,l.useSearchParams)(),{userId:a}=(0,l.useParams)(),s=(0,l.useRouter)(),F=e.get("id"),[P,z]=(0,r.useState)(0),[R,I]=(0,r.useState)(null),{loading:B,orgChatbots:T,selectedChatbot:D,showCreateForm:S,uploads:U,embedCode:$,showEmbedModal:J,deletingChatbotId:G,contextConfig:Z,connectionStatus:M,error:W,setCurrentUser:O,setSelectedChatbot:H,setIsEditMode:Y,setShowCreateForm:q,setActiveTab:X,setShowEmbedModal:K,deleteChatbot:V,generateEmbedCode:Q,initializeStore:ee,testConnection:ea,setError:es}=(0,A.iS)(),et=(0,r.useCallback)(async e=>{try{let a=await E.Ex.getChatbot(e);H(a)}catch(e){console.error("Error loading specific chatbot:",e),C.oR.error("Failed to load chatbot configuration")}},[H]),er=(0,r.useCallback)(async()=>{try{let e=await ea();I(new Date),!e&&P<3?(z(e=>e+1),setTimeout(()=>{er()},2e3*Math.pow(2,P))):e&&(z(0),es(null))}catch(e){console.error("Connection check failed:",e)}},[ea,P,es]),el=(0,r.useCallback)(async()=>{try{let{data:{session:e}}=await k.N.auth.getSession();if(!(null==e?void 0:e.user)){C.oR.error("Please log in to access this page"),s.push("/auth/login");return}O(e.user);try{await ee(),console.debug("✅ Application initialized successfully")}catch(e){console.warn("⚠️ Some features may not be available:",e)}F&&(await et(F),Y(!0))}catch(e){console.error("Error initializing page:",e),es("Failed to initialize the application. Please refresh the page.")}},[ee,O,Y,F,s,et,es]);(0,r.useEffect)(()=>{el()},[el]),(0,r.useEffect)(()=>{if("disconnected"===M){let e=setInterval(er,3e4);return()=>clearInterval(e)}},[M,er]);let ei=()=>{H(null),Y(!1),q(!0),s.push("/dashboard/".concat(a,"/customize"))},en=async(e,t)=>{confirm('Are you sure you want to delete "'.concat(t,'"? This action cannot be undone.'))&&(await V(e),(null==D?void 0:D.id)===e&&(H(null),Y(!1),q(!1),s.push("/dashboard/".concat(a,"/customize"))))},eo=async()=>{z(0),await er(),"disconnected"===M&&await el()};return B?(0,t.jsx)("div",{className:"container mx-auto w-full max-w-7xl px-4 py-8",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)("div",{className:"h-32 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-32 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]}),(0,t.jsx)("div",{className:"h-96 bg-gray-200 rounded"})]})}):(0,t.jsxs)("div",{className:"mx-auto ml-[4.5vw] h-[98vh] overflow-y-scroll bg-white rounded-3xl p-8 ",children:["disconnected"===M&&(0,t.jsxs)(d.Fc,{className:"mb-6 border-red-200 bg-red-50",children:[(0,t.jsx)(m.A,{className:"h-4 w-4 text-red-600"}),(0,t.jsxs)(d.TN,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Connection Lost:"})," Unable to connect to the backend services.",R&&(0,t.jsxs)("span",{className:"text-sm text-red-600 ml-2",children:["Last checked: ",R.toLocaleTimeString()]})]}),(0,t.jsxs)(i.$,{size:"sm",variant:"outline",onClick:eo,className:"ml-4",children:[(0,t.jsx)(h.A,{className:"w-4 h-4 mr-1"}),"Retry (",P,"/3)"]})]})]}),W&&(0,t.jsxs)(d.Fc,{className:"mb-6 border-orange-200 bg-orange-50",children:[(0,t.jsx)(u.A,{className:"h-4 w-4 text-orange-600"}),(0,t.jsx)(d.TN,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Error:"})," ",W,W.includes("Failed to initialize application")&&(0,t.jsx)("div",{className:"mt-2 text-sm text-orange-700",children:"This may be due to network issues or server problems. Try the actions below:"})]}),W.includes("Failed to initialize application")&&(0,t.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,t.jsxs)(i.$,{size:"sm",variant:"outline",onClick:()=>ee(),className:"text-orange-700 border-orange-300 hover:bg-orange-100",children:[(0,t.jsx)(h.A,{className:"w-4 h-4 mr-1"}),"Retry Initialize"]}),(0,t.jsxs)(i.$,{size:"sm",variant:"outline",onClick:()=>{es(null),window.location.reload()},className:"text-orange-700 border-orange-300 hover:bg-orange-100",children:[(0,t.jsx)(g.A,{className:"w-4 h-4 mr-1"}),"Refresh Page"]})]})]})})]}),(0,t.jsxs)("div",{className:"pb-3",children:[(0,t.jsxs)("div",{className:"flex pb-3 items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h1",{className:"font text-3xl font-bold",children:"AI Chatbot Management"}),"connected"===M&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-green-600",children:[(0,t.jsx)(x.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"text-sm",children:"Connected"})]}),"checking"===M&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-yellow-600",children:[(0,t.jsx)(h.A,{className:"w-4 h-4 animate-spin"}),(0,t.jsx)("span",{className:"text-sm",children:"Checking..."})]})]}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Create, configure, optimize, and monitor your AI assistants"})]}),(0,t.jsxs)(i.$,{onClick:ei,className:"flex items-center gap-2",disabled:"disconnected"===M,children:[(0,t.jsx)(p.A,{className:"w-4 h-4"}),"Create New Chatbot"]})]}),T.length>0&&!S&&(0,t.jsxs)(n.Zp,{className:"mb-6 border-1 bg-white",children:[(0,t.jsx)(n.aR,{children:(0,t.jsxs)(n.ZB,{className:"font text-lg flex items-center gap-2",children:[(0,t.jsx)(b.A,{className:"font w-5 h-5"}),"Your Organization's Chatbots"]})}),(0,t.jsx)(n.Wu,{children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.map(e=>(0,t.jsxs)("div",{className:"p-4 border rounded-lg cursor-pointer transition-all hover:shadow-md ".concat((null==D?void 0:D.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>{H(e),Y(!0),q(!1),s.push("/dashboard/".concat(a,"/customize?id=").concat(e.id))},children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,t.jsx)("h3",{className:"font-medium truncate",children:e.name}),(0,t.jsx)(o.E,{variant:"active"===e.status?"default":"secondary",className:"ml-2",children:e.status})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description||"No description"}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:e.color_hex||"#3B82F6"}}),(0,t.jsx)("span",{className:"text-xs text-gray-500 capitalize",children:e.tone||"helpful"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(i.$,{size:"sm",variant:"ghost",onClick:a=>{a.stopPropagation(),window.open("/dashboard/chat?chatbot=".concat(e.id),"_blank")},title:"Test Chatbot",children:(0,t.jsx)(v.A,{className:"w-3 h-3"})}),(0,t.jsx)(i.$,{size:"sm",variant:"ghost",onClick:a=>{a.stopPropagation(),en(e.id,e.name)},disabled:G===e.id,className:"text-red-600 hover:text-red-700 hover:bg-red-50",title:"Delete Chatbot",children:G===e.id?(0,t.jsx)("div",{className:"w-3 h-3 animate-spin rounded-full border-2 border-red-600 border-t-transparent"}):(0,t.jsx)(f.A,{className:"w-3 h-3"})})]})]})]},e.id))})})]}),0===T.length&&!B&&(0,t.jsx)(n.Zp,{className:"mb-6 border-dashed border-2",children:(0,t.jsxs)(n.Wu,{className:"text-center py-12",children:[(0,t.jsx)(b.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No Chatbots Yet"}),(0,t.jsx)("p",{className:"font mb-4",children:"Create your first chatbot to get started with AI-powered customer support."}),(0,t.jsxs)(i.$,{onClick:ei,className:"flex items-center gap-2",disabled:"disconnected"===M,children:[(0,t.jsx)(p.A,{className:"w-4 h-4"}),"Create Your First Chatbot"]})]})})]}),(D||S)&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between pb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[!S&&(0,t.jsxs)(i.$,{variant:"outline",onClick:()=>{H(null),Y(!1),s.push("/dashboard/".concat(a,"/customize"))},className:"pointer flex items-center gap-2 hover:bg-[#5D7DDE] hover:text-white",children:[(0,t.jsx)(j.A,{className:"w-4 h-4"}),"Back to List"]}),(0,t.jsx)("h2",{className:"text-2xl font-bold",children:S?"Create New Chatbot":"Edit: ".concat(null==D?void 0:D.name)})]}),D&&!S&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(i.$,{variant:"outline",onClick:()=>window.open("/dashboard/chat?chatbot=".concat(D.id),"_blank"),className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"w-4 h-4"}),"Test Chatbot"]}),(0,t.jsxs)(i.$,{variant:"outline",onClick:()=>en(D.id,D.name),disabled:G===D.id,className:"flex items-center gap-2 text-red-600 hover:text-red-700 hover:bg-red-50 border-red-200 hover:border-red-300",children:[G===D.id?(0,t.jsx)("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-red-600 border-t-transparent"}):(0,t.jsx)(f.A,{className:"w-4 h-4"}),"Delete Chatbot"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[(0,t.jsx)("div",{className:"xl:col-span-3",children:(0,t.jsx)(L,{})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{className:"text-lg flex items-center gap-2",children:"\uD83D\uDCCA Knowledge Base"})}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Total documents:"}),(0,t.jsx)(o.E,{variant:"outline",children:U.length})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Active sources:"}),(0,t.jsx)(o.E,{variant:"outline",className:"bg-green-50 text-green-700",children:U.filter(e=>"completed"===e.status).length})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Processing:"}),(0,t.jsx)(o.E,{variant:"outline",className:"bg-orange-50 text-orange-700",children:U.filter(e=>"processing"===e.status).length})]}),(0,t.jsx)("div",{className:"pt-2",children:(0,t.jsx)(c.k,{value:U.filter(e=>"completed"===e.status).length/Math.max(U.length,1)*100,className:"mb-3"})}),(0,t.jsxs)(i.$,{variant:"outline",size:"sm",className:"w-full",onClick:()=>s.push("/dashboard/".concat(a,"/train")),children:[(0,t.jsx)(N.A,{className:"w-4 h-4 mr-2"}),"Manage Knowledge Base"]})]})})]}),(0,t.jsxs)(n.Zp,{children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{className:"text-lg flex items-center gap-2",children:"\uD83E\uDDE0 Context Engine Status"})}),(0,t.jsx)(n.Wu,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Model Tier:"}),(0,t.jsx)(o.E,{variant:"secondary",className:"capitalize",children:Z.model_tier})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Strategy:"}),(0,t.jsx)(o.E,{variant:"outline",className:"capitalize",children:Z.retrieval_strategy})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Quality Checks:"}),(0,t.jsx)(o.E,{variant:Z.enable_hallucination_check?"default":"secondary",children:Z.enable_hallucination_check?"Enabled":"Disabled"})]}),(0,t.jsxs)(i.$,{variant:"outline",size:"sm",className:"w-full",onClick:()=>X("context"),children:[(0,t.jsx)(y.A,{className:"w-4 h-4 mr-2"}),"Configure Engine"]})]})})]}),(0,t.jsxs)(n.Zp,{className:"bg-gradient-to-br from-rose-50 to-pink-50 border-rose-200",children:[(0,t.jsx)(n.aR,{children:(0,t.jsx)(n.ZB,{className:"text-lg flex items-center gap-2",children:"\uD83D\uDE80 Deployment"})}),(0,t.jsxs)(n.Wu,{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Your chatbot is optimized and ready for deployment. Generate embed code for websites or integrate via API."}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.$,{size:"sm",className:"w-full",onClick:()=>{if(!(null==D?void 0:D.id))return void C.oR.error("Please save the chatbot first");Q(D.id)},disabled:!(null==D?void 0:D.id),children:"Generate Embed Code"}),(0,t.jsxs)(i.$,{variant:"outline",size:"sm",className:"w-full",onClick:()=>X("analytics"),children:[(0,t.jsx)(w.A,{className:"w-4 h-4 mr-2"}),"View Analytics"]})]})]})]})]})]})]}),J&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Embed Code"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Copy this code and paste it into your website where you want the chatbot to appear:"}),(0,t.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg mb-4",children:(0,t.jsx)("pre",{className:"text-sm overflow-x-auto whitespace-pre-wrap",children:$})}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(i.$,{variant:"outline",onClick:()=>K(!1),children:"Close"}),(0,t.jsxs)(i.$,{onClick:()=>{navigator.clipboard.writeText($),C.oR.success("Embed code copied to clipboard!")},className:"flex items-center gap-2",children:[(0,t.jsx)(_.A,{className:"w-4 h-4"}),"Copy Code"]})]})]})})]})}}},e=>{e.O(0,[508,720,264,273,874,741,927,441,493,358],()=>e(e.s=2491)),_N_E=e.O()}]);